---
title: "Testosterone and cortisol positively interact to predict women’s and men’s sexual desire"
author: "Kevin A Rosenfield, Heather Self, Talia Shirazi, Rodrigo Cardenes, Justin Carre, Triana Ortiz, Khytam Dawood, & David Puts"
date: "9/01/2021"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# load packages

library(pacman); pacman::p_load(lmerTest, psych, sjPlot, sjmisc, sjlabelled,
                                data.table, reshape2, ggcorrplot, stargazer, gridExtra, htmlTable, tidyverse, schoolmath, ggpubr)


# read in data

df <- as.data.frame(read.csv("DHH_df.csv"))
df$ihh_race[df$ihh_ethnicity == 'h'] = 6

# change variable types

df <- df %>%
  filter(study == "ihh", !is.na(ihh_C) | !is.na(ihh_T)) %>%
  dplyr::select(-c(study, msu_ethnicity, AM_T, PM_T, Kinsey_Attr:cgnq24b4_score)) %>%
  mutate_at(vars(ID:IUD), as.factor) %>%
  mutate_at(vars(age:sdi_mean), as.character) %>%
  mutate_at(vars(age:sdi_mean), as.numeric)

df$time <-  as.numeric(as.character(df$time))

# calculate mean soi and soi psychology scores

df <- df %>%
  mutate(soi_mean = rowMeans(dplyr::select(., c(soit1:soit9)), na.rm = TRUE),
         soi_psych = rowMeans(dplyr::select(., c(soi_des, soi_attit)), na.rm = TRUE))

# Calculate days between samples

dfDate <- df %>%
  filter(n_sessions == 2, subID !="CON858") %>%
  dplyr::select(subID, session, Date) %>%
  pivot_wider(names_from = session, values_from = Date) %>%
  `colnames<-`(c("subID", "one", "two"))

dateDiff = vector()
for (i in 1:nrow(dfDate)) {
  dateDiff = append(dateDiff, abs(julian(as.Date(dfDate$one[i]), as.Date(dfDate$two)[i])[1]))
}

dfDate <- bind_cols("subID" = dfDate["subID"], "diff" = dateDiff)
df <- df %>% left_join(dfDate)
df %>% filter(session == 2) %>% dplyr::select(diff) %>% describe()

# calculate subject means and subject mean-center hormone variables; center subject-means; scale subject means and subject-centered data within each sex


df <- df %>%
  group_by(subID) %>%
  mutate(soi.cm = mean(soi_mean, na.rm =TRUE),
         soiA.cm = mean(soi_attit, na.rm =TRUE),
         soiB.cm = mean(soi_behav, na.rm =TRUE),
         soiD.cm = mean(soi_des, na.rm =TRUE),
         sdi.cm = mean(sdi_mean, na.rm =TRUE),
         sdiS.cm = mean(sdi_sol, na.rm =TRUE),
         sdiD.cm = mean(sdi_dyad, na.rm =TRUE),
         ihh_C.cm = mean(ihh_C, na.rm =TRUE),
         ihh_T.cm = mean(ihh_T, na.rm =TRUE),
         ihh_P.cm = mean(ihh_P, na.rm =TRUE),
         ihh_E.cm = mean(ihh_E, na.rm =TRUE),
         ihh_C.cwc = ihh_C - ihh_C.cm,
         ihh_T.cwc = ihh_T - ihh_T.cm,
         ihh_P.cwc = ihh_P - ihh_P.cm,
         ihh_E.cwc = ihh_E - ihh_E.cm,
         binary_T = ifelse(ihh_T == min(ihh_T), "low", "high"),
         binary_C = ifelse(ihh_C == min(ihh_C), "low", "high")) %>%
  ungroup()

# log-transformed

df.log <- df %>%
  group_by(subID) %>%
  mutate(ihh_C.log = log(ihh_C),
         ihh_T.log = log(ihh_T),
         ihh_P.log = log(ihh_P),
         ihh_E.log = log(ihh_E)) %>%
  mutate(ihh_C.log.cm = mean(ihh_C.log, na.rm =TRUE),
         ihh_T.log.cm = mean(ihh_T.log, na.rm =TRUE),
         ihh_P.log.cm = mean(ihh_P.log, na.rm =TRUE),
         ihh_E.log.cm = mean(ihh_E.log, na.rm =TRUE),
         ihh_C.log.cwc = ihh_C.log - mean(ihh_C.log, na.rm =TRUE),
         ihh_T.log.cwc = ihh_T.log - mean(ihh_T.log, na.rm =TRUE),
         ihh_P.log.cwc = ihh_P.log - mean(ihh_P.log, na.rm =TRUE),
         ihh_E.log.cwc = ihh_E.log - mean(ihh_E.log, na.rm =TRUE)) %>%
  ungroup() %>%
  group_by(sex) %>%
  mutate(ihh_C.log.cwc = ihh_C.log.cwc / sd(ihh_C.log.cwc, na.rm = TRUE),
         ihh_T.log.cwc = ihh_T.log.cwc / sd(ihh_T.log.cwc, na.rm = TRUE),
         ihh_P.log.cwc = ihh_P.log.cwc / sd(ihh_P.log.cwc, na.rm = TRUE),
         ihh_E.log.cwc = ihh_E.log.cwc / sd(ihh_E.log.cwc, na.rm = TRUE),
         ihh_C.log.cm = (ihh_C.log.cm - mean(ihh_C.log.cm, na.rm = TRUE)) / sd(ihh_C.log.cm, na.rm = TRUE),
         ihh_T.log.cm = (ihh_T.log.cm - mean(ihh_T.log.cm, na.rm = TRUE)) / sd(ihh_T.log.cm, na.rm = TRUE),
         ihh_P.log.cm = (ihh_P.log.cm - mean(ihh_P.log.cm, na.rm = TRUE)) / sd(ihh_P.log.cm, na.rm = TRUE),
         ihh_E.log.cm = (ihh_E.log.cm - mean(ihh_E.log.cm, na.rm = TRUE)) / sd(ihh_E.log.cm, na.rm = TRUE))


# break out datasets by sex/study/hormonal contraception use

df.m <- df %>% filter(sex == "m")
df.f <- df %>% filter(sex == "f")
df.hc <- df.f[df.f$HC == 1,]
df.nc <- df.f[df.f$HC == 0,]
df.log.m <- df.log %>% filter(sex == "m")
df.log.f <- df.log %>% filter(sex == "f")

# create function for easier viewing of model output

table.model <- function(model) {
  model$coefficients %>%
    as.data.frame() %>%
    rownames_to_column(var = "Effect") %>%
    mutate_if(is.numeric, round, 3) %>%
    rename("SE" = 3, "tVal" = 5, "p" = 6) %>%
    mutate(CI = paste0(round(Estimate - (1.96 * SE),2), "; " ,round(Estimate + (1.96 * SE),2))) %>%
    relocate(CI, .after = Estimate) %>%
    relocate(SE, .after = Estimate)
}
# this function runs an MLM using unstandardized, then standardized predictors and outcomes

model_function <- function(df, outcome, HC = FALSE) {
  
  if (HC == TRUE) {
    model1 <- lmer(unlist(df[outcome]) ~ ihh_C.cwc + ihh_T.cwc + ihh_C.cwc:ihh_T.cwc +
                     ihh_C.cm + ihh_T.cm + ihh_C.cm:ihh_T.cm + ihh_C.cwc:HC + ihh_T.cwc:HC + ihh_C.cwc:ihh_T.cwc:HC +
                     ihh_C.cm:HC + ihh_T.cm:HC + ihh_C.cm:ihh_T.cm:HC + HC + (1|subID), data = df)
    
    model2 <- lmer(scale(unlist(df[outcome])) ~ scale(ihh_C.cwc) + scale(ihh_T.cwc) + ihh_C.cwc:ihh_T.cwc +
                     scale(ihh_C.cm) + scale(ihh_T.cm) + ihh_C.cm:ihh_T.cm + ihh_C.cwc:HC + ihh_T.cwc:HC + ihh_C.cwc:ihh_T.cwc:HC +
                     ihh_C.cm:HC + ihh_T.cm:HC + ihh_C.cm:ihh_T.cm:HC + HC + (1|subID), data = df)
    
  }
  
  else {
  
    model1 <- lmer(unlist(df[outcome]) ~ ihh_C.cwc + ihh_T.cwc + ihh_C.cwc:ihh_T.cwc +
                     ihh_C.cm + ihh_T.cm + ihh_C.cm:ihh_T.cm + (1|subID), data = df)
    
    model2 <- lmer(scale(unlist(df[outcome])) ~ scale(ihh_C.cwc) + scale(ihh_T.cwc) + ihh_C.cwc:ihh_T.cwc +
                     scale(ihh_C.cm) + scale(ihh_T.cm) + ihh_C.cm:ihh_T.cm + (1|subID), data = df)
  
  }
  
  summary(model1)$coefficients %>%
    as.data.frame() %>%
    rownames_to_column(var = "Effect") %>%
    mutate_if(is.numeric, round, 3) %>%
    rename("SE" = 3, "t_val" = 5, "p_val" = 6) %>%
    mutate(CI = paste0("[",round(Estimate - (1.96 * SE),2), "; " ,round(Estimate + (1.96 * SE),2),"]")) %>%
    relocate(CI, .after = Estimate) %>%
    relocate(SE, .after = Estimate) %>%
    bind_cols(
  
    summary(model2)$coefficients %>%
      as.data.frame() %>%
      rownames_to_column(var = "Effect") %>%
      mutate_if(is.numeric, round, 3) %>%
      rename("Beta" = 2, "Beta_SE" = 3, "t_val" = 5, "p" = 6) %>%
      mutate(Beta_CI = paste0("[",round(Beta - (1.96 * Beta_SE),2), "; " ,round(Beta + (1.96 * Beta_SE),2),"]")) %>%
      relocate(Beta_CI, .after = Beta) %>%
      dplyr::select(-c(Effect, Beta_SE, t_val, df, p))
    ) %>% relocate(df, .after = Beta_CI) %>% relocate(t_val, .after = df) %>% relocate(p_val, .after = t_val)
}

# simple slopes function

# simple slopes at subject-mean centered cortisol = -2, -1, 0 +1, and +2 SDs

simpleSlopes <- function(data, dependent, min, max, interval) {
  
  model <- lm(dependent~ data$ihh_T.cwc*data$ihh_C.cwc)
  est <- summary(model)[4]$coefficients[1:4,1] %>% unlist
  df <- summary(model)[[7]][2]
  slopelist <- c()
  clist <- c()
  plist <- c()
  tlist <- c()
  
  dflist <- c()
  
  for (i in seq(min,max,by=interval)) {
    
    d <- data.frame(cat = i, estimate = est[1] + est[2]*data["ihh_T.cwc"] + est[3]*i +
                 est[4]*data["ihh_T.cwc"]*i, data["ihh_T.cwc"])
    
    colnames(d) <- c("cort_level", "estimate", "testosterone")
    
    dflist <- bind_rows(dflist, d)
    
    intercept <- est[1] + est[3]*i
    slope <- est[4]*i + est[2]
    v <- vcov(model, full = TRUE, ranpar = "var")
    se <- v[2,2] + 2*i*v[2,4] + i*i*v[4,4]
    
    t <- round(slope / sqrt(se),2)
    slopelist <- c(slopelist,paste0(round(slope,2), " (",round(se,2),")"))
    clist <- c(clist,i)
    tlist <- c(tlist, t)
    plist <- c(plist, round(pt(t,df,lower.tail=is.negative(t)),3))
  }
  
  dflist$cort_level <- as.factor(dflist$cort_level)
  stats <- data.frame(Cortisol = clist, "Coefficient(SE)" = slopelist, tValue = tlist, pValue = plist)
  return(c(dflist,stats))
}

```

## Dual-Hormone Hypothesis Statistical programming

```{r descriptives setup, include=FALSE}

# inter-item reliability tests (cronbach's alpha for SOI and SDI questions)

SOI_R <- df %>%
  dplyr::select(soit1:soit9)

SDI_2 <- df %>%
  dplyr::select(sdi1:sdi14)

library(ltm)

```

### 1. Cronbach's alphas

```{r descriptives, echo=FALSE}
cronbach.alpha(SOI_R, na.rm = T)
cronbach.alpha(SDI_2, na.rm = T)
detach(package:ltm)
remove(SDI_2)
remove(SOI_R)

```

### 2. Do values for session 1 hormonal or psychosexual variables differ for subjects who returned for a second session vs those who didn't?
#### (t-test with null hypothesis of no difference; p-values below)
```{r differences between subjects who attended 1 or 2 sessions, echo=FALSE}

compareNumberSessions <- df %>%
  dplyr::select(subID, n_sessions, sex, session, ihh_C.cm, ihh_T.cm, soi.cm,  soiA.cm, soiB.cm, soiD.cm, sdi.cm, sdiD.cm, sdiS.cm) %>%
  filter(session == 1) %>%
  pivot_wider(names_from = n_sessions, values_from = ihh_C.cm:sdiS.cm)

labelled <- list("Cortisol:", "Testosterone:", "SOI-R:",  "SOI Attitudes:", "SOI Behavior:", "SOI Desire:", "SDI-2:", "SDI Dyadic:", "SDI Solitary:")

compareNumberSessionsM <- compareNumberSessions %>% filter(sex == "m")
compareNumberSessionsF <- compareNumberSessions %>% filter(sex == "f")

j = 1
for (i in seq(4,20,2)) {
  print(paste("Men's", labelled[j], t.test(compareNumberSessionsM[i], compareNumberSessionsM[i + 1])[3] %>% unlist() %>% round(3)))
  j = j + 1
}

j = 1
for (i in seq(4,20,2)) {
  print(paste("Women's", labelled[j], t.test(compareNumberSessionsF[i], compareNumberSessionsF[i + 1])[3] %>% unlist() %>% round(3)))
  j = j + 1
}

```

### 3. Total n of subjects and those who attended 1 or 2 sessions

```{r  n of subjects who attended 1 or 2 sessions, echo=FALSE}

# Women in study
print("Women in study")
df %>% filter(sex == "f", session == 1) %>% count()

# Men in study
print("Men in study")
df %>% filter(sex == "m", session == 1) %>% count()

nc1 <- df %>% filter(HC == 0, sex == "f", n_sessions == 1) %>% count() %>% as.numeric()
hc1 <- df %>% filter(HC == 1, n_sessions == 1) %>% count() %>% as.numeric()

m1 <- df %>% filter(sex == "m", n_sessions == 1) %>% count() %>% as.numeric()

nc2 <- df %>% filter(HC == 0, sex == "f", n_sessions == 2) %>% filter(session==1) %>% count() %>% as.numeric()
hc2 <- df %>% filter(HC == 1, n_sessions == 2) %>% filter(session==1) %>% count() %>% as.numeric()

m2 <- df %>% filter(sex=="m", n_sessions==2) %>% filter(session==1) %>% count() %>% as.numeric()

data.frame("One Session" = c(nc1, hc1, m1),"Two Sessions" = c(nc2, hc2, m2), row.names = c("NC women", "HC Women", "Men")) %>% htmlTable()
# Table 1 - age, total n, and n of subs with at least one set of T, C, and either SDI or SOI samples

options(table_counter = TRUE)

df %>%
  filter(session == 1) %>%
  group_by(sex, HC) %>%
  summarise("Age (mean)" = round(mean(age), 2), "SD" = round(sd(age), 2), n = n()) %>%
  filter(!is.na(HC) | sex == "m") %>%
  ungroup() %>%
  dplyr::select(-c(HC, sex)) %>%
  htmlTable(align = "c",
            caption = "Age statistics broken out by subgroup",
            rnames = c("Women (NC)", "Women (HC)", "Men"))

```

```{r Table 2 and 3 Preperation, include=FALSE, echo=FALSE}
table2 <- df.m %>%
  group_by(subID) %>%
  dplyr::select(ihh_T, ihh_C, ihh_P, ihh_E) %>%
  summarise_all(funs(mean)) %>%
  describe %>%
  bind_cols(as.numeric(rep("",5)), df.hc %>%
              group_by(subID) %>%
              dplyr::select(ihh_T, ihh_C, ihh_P, ihh_E) %>%
              summarise_all(funs(mean)) %>%
              describe, as.numeric(rep("",5)), df.nc %>%
              group_by(subID) %>%
              dplyr::select(ihh_T, ihh_C, ihh_P, ihh_E) %>%
              summarise_all(funs(mean)) %>%
              describe)
table2 <- round(table2, 2)
table2[4:5, 2:4] <- "N/A"

table3 <- df.m %>%
  group_by(subID) %>%
  dplyr::select(soi_mean, soi_attit, soi_behav, soi_des, sdi_mean, sdi_sol, sdi_dyad, ihh_T, ihh_C) %>%
  filter(!is.na(ihh_T), !is.na(ihh_C)) %>%
  summarise_all(funs(mean)) %>%
  describe %>%
  bind_cols(as.numeric(rep("",10)), df.nc %>%
              group_by(subID) %>%
              dplyr::select(soi_mean, soi_attit, soi_behav, soi_des, sdi_mean, sdi_sol, sdi_dyad, ihh_T, ihh_C) %>%
              filter(!is.na(ihh_T), !is.na(ihh_C)) %>%
              summarise_all(funs(mean)) %>%
              describe %>%
              bind_cols(as.numeric(rep("",10)), df.hc %>%
                          group_by(subID) %>%
                          dplyr::select(soi_mean, soi_attit, soi_behav, soi_des, sdi_mean, sdi_sol, sdi_dyad, ihh_T, ihh_C) %>%
                          filter(!is.na(ihh_T), !is.na(ihh_C)) %>%
                          summarise_all(funs(mean)) %>%
                          describe))

```

### 4. Stats for hormone values (pg/mL)

```{r Table 2 raw hormones, echo=FALSE, echo=FALSE}

table2Rows = c("T", "C", "P", "E")
table2Cols = c("n", "Mean", "SD")

htmlTable(table2[2:5,c(14, 2:4, 14, 16:18, 28, 30:32)],
          align = "c",
          caption = "Raw hormone descriptive statistics",
          rnames = table2Rows, 
          header = c("", table2Cols, "", table2Cols, "", table2Cols),
          col.rgroup = c("none", "#F7F7F7"),
          cgroup = c("", "Men", "", "Women (HC)", "", "Women (NC)"), n.cgroup = c(1, 3, 1, 3, 1, 3))

rangeOfDays <- abs(range(c(as.numeric(as.Date(unlist(df.f %>%
                                    dplyr::select(Date)))),as.numeric(as.Date(unlist(df.m %>%
                                                                            dplyr::select(Date)))))-as.numeric(as.Date("2016-6-21")),na.rm=T))

meanOfDays <- abs(mean(c(as.numeric(as.Date(unlist(df.f %>%
                                    dplyr::select(Date)))),as.numeric(as.Date(unlist(df.m %>%
                                                                            dplyr::select(Date)))))-as.numeric(as.Date("2016-6-21")),na.rm=T))

print(paste("Samples were analyzed on average",round(meanOfDays),"days after being collected; range =",rangeOfDays[2],"to",rangeOfDays[1], "days."))
```

```{r C and T value boxplots, echo=FALSE}
ggplot(df.f, aes(ihh_C), title()) + geom_boxplot() + ggtitle("Boxplot of Women's cortisol levels (pg/mL)")
ggplot(df.m, aes(ihh_C)) + geom_boxplot()  + ggtitle("Boxplot of Men's cortisol levels (pg/mL)")

ggplot(df.f, aes(ihh_T), title()) + geom_boxplot() + ggtitle("Boxplot of Women's Testosterone levels (pg/mL)")
ggplot(df.m, aes(ihh_T)) + geom_boxplot()  + ggtitle("Boxplot of Men's Testosterone levels (pg/mL)")
```

### 5. Stats for psychosexual scales and subscales

```{r Table 3 scales and subscales, echo=FALSE}
table3Rows = c("SOI-R ", "SOI: Attitudes", "SOI: Behavior", "SOI: Desire", "SDI-2", "SDI: Solitary", "SDI: Dyadic")
table3Cols = c("n", "Mean", "SD")

htmlTable(round(table3[2:8,c(2:4, 14, 16:18, 28, 30:32)], 2),
          align = "c",
          caption = "Responses to SOI-R, SDI-2, and subscales",
          rnames = table3Rows, 
          header = c(table3Cols, "", table3Cols, "", table3Cols),
          col.rgroup = c("none", "#F7F7F7"),
          cgroup = c("Men", "", "Women (NC)", "", "Women (HC)"), n.cgroup = c(3, 1, 3, 1, 3))
```

### 6. Numbers of subjects with one or two sets of T or C and SDI or SOI samples

```{r Table 4 n of subs with one or two sets of T, C, and either SDI or SOI samples, include=FALSE, echo=FALSE}

table4 <- df %>%
  filter(session == 1) %>%
  dplyr::select(n_sessions, sex, HC, ihh_T, ihh_C, sdi_mean, soi_mean) %>%
  group_by(n_sessions, sex, HC) %>%
  summarise(n = n(),
            "n (SOI)" = sum(!is.na(ihh_T) & !is.na(ihh_C) & !is.na(soi_mean)),
            "n (SDI)" = sum(!is.na(ihh_T) & !is.na(ihh_C) & !is.na(sdi_mean))) %>%
  filter(!is.na(HC) | sex == "m") %>%
  ungroup() %>%
  dplyr::select(-c(HC, sex, n_sessions))

```

```{r table 4, echo=FALSE}
table4 %>% htmlTable(align = "c",
          col.rgroup = c("none", "#F7F7F7"),
          tspanner = c("Single session","2 Sessions"), n.tspanner = c(3,3),
          caption = "Sample sizes broken out by number of sessions",
          rnames = c("Women (NC)", "Women (HC)", "Men",
                     "Women (NC)", "Women (HC)", "Men"))

```

```{r group differences, include=FALSE}
# sex and hormonal contraception group differences on SOI-R, SDI-2, and subject-mean hormones

ihh.sex <- df %>%
  filter(!is.na(soi_mean), !is.nan(soi_mean), !is.na(sex)) %>%
  dplyr::select(subID, HC, sex, soi_mean, soi_attit, soi_behav, soi_des, sdi_mean, sdi_dyad, sdi_sol, ihh_C, ihh_T, ihh_P, ihh_E) %>%
  group_by(subID) %>%
  mutate(soi_mean = mean(soi_mean),
         sdi_mean = mean(sdi_mean),
         C_mean = mean(soi_mean),
         T_mean = mean(sdi_mean))

ihh.women <- ihh.sex %>% filter(sex == "f")

```

```{r race/ethnicity, echo=FALSE}
# race/ethnicity histograms

par(mar=c(9,1,4,2))

df.f %>%
  filter(session == 1, !is.na(ihh_race)) %>%
  dplyr::select(ihh_race) %>%
  unlist() %>%
  hist(xlim = range(1,6), ylim = range(0,650), density = 15, labels = TRUE, col = "blue1", border = "dodgerblue3",
       breaks = 5, main = paste("Histogram of Women's\nRace/Ethnicity"), ylab = "", axes = FALSE)

axis(1, at = c(2.5, 3.5, 4.5, 5.5),
     labels = c("Asian", "Pacific Islander", "White, non-Hispanic", "Black or Af. American"), las=2)

df.m %>%
  filter(session == 1, !is.na(ihh_race)) %>%
  dplyr::select(ihh_race) %>%
  unlist() %>%
  hist(xlim = range(1,6), ylim = range(0,200), density = 15, labels = TRUE, col = "red1", border = "dodgerblue3",
       breaks = 5, main = paste("Histogram of Men's\nRace/Ethnicity"), ylab = "", axes = FALSE)

axis(1, at = c(2.5, 3.5, 4.5, 5.5),
     labels = c("Asian", "Pacific Islander", "White, non-Hispanic", "Black or Af. American"), las=2)

par(mar=c(3,3,3,3))
```

### 7. p-values for women vs. men survey and hormone values

```{r group differences stats sex, echo=FALSE}
for (i in 4:12){
  p <- t.test(unlist(ihh.sex[i])~ unlist(ihh.sex$sex))[3][[1]]
  print(paste(names(ihh.women[i]), round(p,5)))
}

```

### p-values for women on vs. women off hormonal contraception survey and hormone values

```{r group differences stats contraception, echo=FALSE}
for (i in 4:14){
  p <- t.test(unlist(ihh.women[i])~ unlist(ihh.women$HC))[3][[1]]
  print(paste(names(ihh.women[i]), round(p,5)))
}

remove(ihh.sex)
remove(ihh.women)

```

## Plots

### 8. Men - SDI and subscales, SOI and subscales, and combined
```{r pairs panels plots, echo=FALSE}
# Supplementary Figures 1-4 : Correlations of scales and their subscales; each scale/sex combination presented separately

pairs.panels(
  df.m %>% dplyr::select(sdi_mean, sdi_sol, sdi_dyad), stars= TRUE, method = "pearson", hist.col = "gray", cex.labels=1.3, cex.cor = 1, ellipses = FALSE)

pairs.panels(
  df.m %>% dplyr::select(soi_mean, soi_attit, soi_behav, soi_des), stars= TRUE, method = "pearson", hist.col = "gray", cex.labels=1.3, cex.cor = 1, ellipses = FALSE)

pairs.panels(
  df.m %>% dplyr::select(soi_mean, soi_attit, soi_behav, soi_des, sdi_mean, sdi_sol, sdi_dyad), stars= TRUE, method = "pearson", hist.col = "gray", cex.labels=1, cex.cor = 1, ellipses = FALSE)

```

### Women - SDI and subscales, SOI and subscales, and combined

```{r women pairs panels, echo=FALSE}

pairs.panels(
  df.f %>% dplyr::select(sdi_mean, sdi_sol, sdi_dyad), stars= TRUE, method = "pearson", hist.col = "gray", cex.labels=1.3, cex.cor = 1, ellipses = FALSE)

pairs.panels(
  df.f %>% dplyr::select(soi_mean, soi_attit, soi_behav, soi_des), stars= TRUE, method = "pearson", hist.col = "gray", cex.labels=1.3, cex.cor = 1, ellipses = FALSE)

pairs.panels(
  df.f %>% dplyr::select(soi_mean, soi_attit, soi_behav, soi_des, sdi_mean, sdi_sol, sdi_dyad), stars= TRUE, method = "pearson", hist.col = "gray", cex.labels=1, cex.cor = , ellipses = FALSE)

```

### 9. Main text figures 1 and 2 - sexual desire ~ testosterone grouped by cortisol level

```{r Main text figures 1-2 1, echo=FALSE}
data.nc <- simpleSlopes(df.nc, df.nc$sdi_dyad, -2,2,1)

stats.nc <- data.frame(data.nc[4:7])
data.nc <- data.frame(data.nc[1:3])

nc = ggplot(data.nc, aes(testosterone,estimate, linetype = cort_level)) +
  geom_smooth(method='lm', formula= y~x, se=F, color="black") +
  scale_linetype_manual(values=c("dotted", "dotdash", "dashed", "longdash", "solid")) +
  scale_color_manual("black") + labs(linetype="Cortisol SDs from mean") +
  xlim(c(-2,2)) + ylim(c(4,7)) + theme_classic() + 
  theme(legend.position="none", legend.key.width = unit(1.6, 'cm'), legend.key.height = unit(1.6, 'cm'), legend.title = element_text(size=13),
        legend.text = element_text(size=13), axis.title.x = element_text(size=11, face="bold"),axis.title.y = element_text(size=11, face="bold"),
        plot.title = element_text(size = 13, face = "bold")) +
  ylab("Dyadic sexual desire") + xlab("Subject-mean centered testosterone") + ggtitle("(a)")
ncLegend <- nc + theme(legend.position="bottom", legend.key.height = unit(1.6, 'cm'))

data.hc <- simpleSlopes(df.hc, df.hc$sdi_dyad,-2,2,1)

stats.hc <- data.frame(data.hc[4:7])
data.hc <- data.frame(data.hc[1:3])

#for (i in c(-2,-1,0,1,2)){
#  print(summary(lm(estimate ~ testosterone,data %>% filter(cort_level==i))))
#}

hc = ggplot(data.hc, aes(testosterone,estimate, linetype = cort_level)) +
  geom_smooth(method='lm', formula= y~x, se=F, color="black") +
  scale_linetype_manual(values=c("dotted", "dotdash", "dashed", "longdash", "solid")) +
  scale_color_manual("black") + labs(linetype="Cortisol SDs from mean") +
  xlim(c(-2,2)) + ylim(c(4,7)) + theme_classic() +
  theme(legend.position="none", legend.key.width = unit(1.6, 'cm'), legend.key.height = unit(3.6, 'cm'), legend.title = element_text(size=13),
        legend.text = element_text(size=12), axis.title.x = element_text(size=11, face="bold"),axis.title.y = element_text(size=11, face="bold"),
        plot.title = element_text(size = 13, face = "bold")) +
  ylab("Dyadic sexual desire") + xlab("Subject-mean centered testosterone") + ggtitle("(b)")

data.msol <- simpleSlopes(df.m, df.m$sdi_sol,-2,2,1)

stats.msol <- data.frame(data.msol[4:7])
data.msol <- data.frame(data.msol[1:3])


#for (i in c(-2,-1,0,1,2)){
#  print(summary(lm(estimate ~ testosterone,data %>% filter(cort_level==i))))
#}

m.sol = ggplot(data.msol, aes(testosterone,estimate, linetype = cort_level)) +
  geom_smooth(method='lm', formula= y~x, se=F, color="black") +
  scale_linetype_manual(values=c("dotted", "dotdash", "dashed", "longdash", "solid")) +
  scale_color_manual("black") + labs(linetype="Cortisol SDs from mean") + xlim(c(-2,2)) + ylim(c(4,7)) + theme_classic() +
  theme(legend.position="none", legend.key.width = unit(1.6, 'cm'), legend.key.height = unit(1.6, 'cm'), legend.title = element_text(size=13),
        legend.text = element_text(size=12), axis.title.x = element_text(size=11, face="bold"),axis.title.y = element_text(size=11, face="bold"),
        plot.title = element_text(size = 13, face = "bold")) + ylab("Solitary sexual desire") +
  xlab("Subject-mean centered testosterone") + ggtitle("(a)")
m.solLegend <- m.sol + theme(legend.position="bottom", legend.key.height = unit(1.6, 'cm'))

data.mdyad <- simpleSlopes(df.m, df.m$sdi_dyad,-2,2,1)

stats.mdyad <- data.frame(data.mdyad[4:7])
data.mdyad <- data.frame(data.mdyad[1:3])

#for (i in c(-2,-1,0,1,2)){
#  print(summary(lm(estimate ~ testosterone,data %>% filter(cort_level==i))))
#}

m.dyad = ggplot(data.mdyad, aes(testosterone,estimate, linetype = cort_level)) +
  geom_smooth(method='lm', formula= y~x, se=F, color="black") +
  scale_linetype_manual(values=c("dotted", "dotdash", "dashed", "longdash", "solid")) +
  scale_color_manual("black") + labs(linetype="Cortisol SDs from mean") + xlim(c(-2,2)) + ylim(c(4,7)) + theme_classic() +
  theme(legend.position="none", legend.key.width = unit(1.6, 'cm'), legend.key.height = unit(3.6, 'cm'), legend.title = element_text(size=13),
        legend.text = element_text(size=12), axis.title.x = element_text(size=11, face="bold"),axis.title.y = element_text(size=11, face="bold"),
        plot.title = element_text(size = 13, face = "bold")) +
  ylab("Dyadic sexual desire") + xlab("Subject-mean centered testosterone") + ggtitle("(b)")

figureWomen <- ggarrange(nc,hc, ncol=2, nrow=1) %>%
  gridExtra::grid.arrange(get_legend(ncLegend), heights = unit(c(85, 20), "mm"))
figureWomen

figureMen <- ggarrange(m.sol,m.dyad, ncol=2, nrow=1) %>%
  gridExtra::grid.arrange(get_legend(m.solLegend), heights = unit(c(85, 20), "mm"))
figureMen
```

### Simple slopes data for various groups. Lines represent subfacets of sexual desire as functions of testosterone at 5 cortisol levels
```{r simple slopes stats, echo=FALSE}

htmlTable(stats.nc, caption = "Dydadic Desire - Women NOT ON hormonal contracption")
htmlTable(stats.hc, caption = "Dydadic Desire - Women on hormonal contracption")
htmlTable(stats.msol, caption = "Men's Soliatary desire")
htmlTable(stats.mdyad, caption = "Men's Dyadic Desire")

```

## 10. Main and exploratory (subscale) analyses

```{r main analyses, include=FALSE}

### Main Analyses: hormones centered; Within(cwc)- and between(cm)-individual effects ARE isolated

# men

m.d_w <- model_function(df.m, "sdi_mean")

m.sol_w <- model_function(df.m, "sdi_sol")

m.dyad_w <- model_function(df.m, "sdi_dyad")

m.s_w <- model_function(df.m, "soi_mean")

m.att_w <- model_function(df.m, "soi_attit")

m.beh_w <- model_function(df.m, "soi_behav")

m.des_w <- model_function(df.m, "soi_des")


# women

w.d_w <- model_function(df.f, "sdi_mean",1)

w.sol_w <- model_function(df.f, "sdi_sol",1)

w.dyad_w <- model_function(df.f, "sdi_dyad",1)

w.s_w <- model_function(df.f, "soi_mean",1)

w.att_w <- model_function(df.f, "soi_attit",1)

w.beh_w <- model_function(df.f, "soi_behav",1)

w.des_w <- model_function(df.f, "soi_des",1)

##### Table 5 - Sociosexual orientation (women NOT broken out by hormonal contraception use)

table5cols <- c("Estimate", "SE", "CI", "Beta", "Beta CI", "df", "t", "p")
table5rows <- c("Intercept", "C (within)", "T (within)", "C (between)", "T (between)", "HC",
                "T x C (within)", "T x C (between)", "C (within) x HC", "T (within) x HC",
                "C (between) x HC", "T (between) x HC", "T x C (within) x HC", "T x C (between) x HC")
table5 <- bind_rows(bind_cols(w.s_w[-c(1)], w.att_w[-c(1)], w.beh_w[-c(1)], w.des_w[-c(1)]))
                          
##### Table 6 - Sexual desire (women NOT broken out by hormonal contraception use)

table6cols <- c("Estimate", "SE", "CI", "Beta", "Beta CI", "df", "t", "p")
table6rows <- c("Intercept", "C (within)", "T (within)", "C (between)", "T (between)", "HC",
                "T x C (within)", "T x C (between)", "C (within) x HC", "T (within) x HC",
                "C (between) x HC", "T (between) x HC", "T x C (within) x HC", "T x C (between) x HC")
table6 <- bind_rows(bind_cols(w.d_w[-c(1)], w.sol_w[-c(1)], w.dyad_w[-c(1)]))

##### Table 7 - Sociosexual orientation (men)

table7cols <- c("Estimate", "SE", "CI", "Beta", "Beta CI", "df", "t", "p")
table7rows <- c("Intercept", "C (within)", "T (within)", "C (between)",
                "T (between)", "T x C (within)", "T x C (between)")
table7 <- bind_rows(bind_cols(m.s_w[-c(1)], m.att_w[-c(1)], m.beh_w[-c(1)], m.des_w[-c(1)]))

##### Table 8 - Sexual desire (men)

table8cols <- c("Estimate", "SE", "CI", "Beta", "Beta CI", "df", "t", "p")
table8rows <- c("Intercept", "C (within)", "T (within)", "C (between)",
                "T (between)", "T x C (within)", "T x C (between)")
table8 <- bind_rows(bind_cols(m.d_w[-c(1)], m.sol_w[-c(1)], m.dyad_w[-c(1)]))

```

```{r print tables, echo=FALSE}

htmlTable(table5,
          align = "c",
          caption = "SOI-R Model results: Women",
          rnames = c(table5rows, table5rows, table5rows),
          header = c(table5cols, table5cols, table5cols, table5cols),
          col.rgroup = c("none", "#F7F7F7"),
          cgroup = list(c("SOI-R"), c("General", "Attitudes", "Behavior", "Desire")),
          n.cgroup = list(c(32), c(8, 8, 8, 8)),
          tspanner = c("Women"), n.tspanner = c(14),
          css.tspanner = "padding-top: 0.5em; font-weight:bold",
          css.cell = "padding-right: 0.5em")

htmlTable(table6,
          align = "c",
          caption = "SDI-2 Model results: Women",
          rnames = c(table6rows, table6rows, table6rows),
          header = c(table6cols, table6cols, table6cols),
          col.rgroup = c("none", "#F7F7F7"),
          cgroup = list(c("SDI-2"), c("General", "Solitary", "Dyadic")),
          n.cgroup = list(c(24), c(8, 8, 8)),
          tspanner = c("Women"), n.tspanner = c(14),
          css.tspanner = "padding-top: 0.5em; font-weight:bold",
          css.cell = "padding-right: 0.5em")

htmlTable(table7,
          align = "c",
          caption = "SOI-R Model results: Men",
          rnames = c(table7rows, table7rows, table7rows),
          header = c(table7cols, table7cols, table7cols, table7cols),
          col.rgroup = c("none", "#F7F7F7"),
          cgroup = list(c("SOI-R"), c("General", "Attitudes", "Behavior", "Desire")),
          n.cgroup = list(c(32), c(8, 8, 8, 8)),
          tspanner = c("Men"), n.tspanner = c(7),
          css.tspanner = "padding-top: 0.5em; font-weight:bold",
          css.cell = "padding-right: 0.5em")



htmlTable(table8,
          align = "c",
          caption = "SDI-2 Model results: Men",
          rnames = c(table8rows, table8rows, table8rows),
          header = c(table8cols, table8cols, table8cols),
          col.rgroup = c("none", "#F7F7F7"),
          cgroup = list(c("SDI-2"), c("General", "Solitary", "Dyadic")),
          n.cgroup = list(c(24), c(8, 8, 8)),
          tspanner = c("Men"), n.tspanner = c(7),
          css.tspanner = "padding-top: 0.5em; font-weight:bold",
          css.cell = "padding-right: 0.5em")

```

## 11. Robustness analyses and false discovery rate corrections

```{r robustness model setup, include=FALSE}

# women taking hormonal contraception

hc.d_w <- model_function(df.hc, "sdi_mean")

hc.sol_w <- model_function(df.hc, "sdi_sol")

hc.dyad_w <- model_function(df.hc, "sdi_dyad")

hc.s_w <- model_function(df.hc, "soi_mean")

hc.att_w <- model_function(df.hc, "soi_attit")

hc.beh_w <- model_function(df.hc, "soi_behav")

hc.des_w <- model_function(df.hc, "soi_des")

# women NOT taking hormonal contraception

nc.d_w <- model_function(df.nc, "sdi_mean")

nc.sol_w <- model_function(df.nc, "sdi_sol")

nc.dyad_w <- model_function(df.nc, "sdi_dyad")

nc.s_w <- model_function(df.nc, "soi_mean")

nc.att_w <- model_function(df.nc, "soi_attit")

nc.beh_w <- model_function(df.nc, "soi_behav")

nc.des_w <- model_function(df.nc, "soi_des")

##### ESM Table 9 - Sociosexual orientation (women broken out by hormonal contraception use)

table9cols <- c("Estimate", "SE", "CI", "Beta", "Beta CI", "df", "t", "p")
table9rows <- c("Intercept", "C (within)", "T (within)", "C (between)",
                "T (between)", "T x C (within)", "T x C (between)")
table9 <- bind_rows(bind_cols(m.s_w[-c(1)], m.att_w[-c(1)], m.beh_w[-c(1)], m.des_w[-c(1)]),
                          bind_cols(nc.s_w[-c(1)], nc.att_w[-c(1)], nc.beh_w[-c(1)], nc.des_w[-c(1)]),
                          bind_cols(hc.s_w[-c(1)], hc.att_w[-c(1)], hc.beh_w[-c(1)], hc.des_w[-c(1)]))

##### ESM Table 10 - Sociosexuality (women broken out by hormonal contraception use)

table10cols <- c("Estimate", "SE", "CI", "Beta", "Beta CI", "df", "t", "p")
table10rows <- c("Intercept", "C (within)", "T (within)", "C (between)",
                "T (between)", "T x C (within)", "T x C (between)")
table10 <- bind_rows(bind_cols(m.d_w[-c(1)], m.sol_w[-c(1)], m.dyad_w[-c(1)]),
                          bind_cols(nc.d_w[-c(1)], nc.sol_w[-c(1)], nc.dyad_w[-c(1)]),
                          bind_cols(hc.d_w[-c(1)], hc.sol_w[-c(1)], hc.dyad_w[-c(1)]))

```

#### seperate models for hormonal contraception and no HC

```{r table 9-10, echo=FALSE}

htmlTable(table9,
          align = "c",
          caption = "SOI-R Model results",
          rnames = c(table9rows, table9rows, table9rows),
          header = c(table9cols, table9cols, table9cols, table9cols),
          col.rgroup = c("none", "#F7F7F7"),
          cgroup = list(c("SOI-R"), c("General", "Attitudes", "Behavior", "Desire")),
          n.cgroup = list(c(4), c(8, 8, 8, 8)),
          tspanner = c("Men","Women not usng hormonal contraception", "Women using hormonal contraception"), n.tspanner = c(7,7),
          css.tspanner = "padding-top: 0.5em; font-weight:bold",
          css.cell = "padding-right: 0.5em")

htmlTable(table10,
          align = "c",
          caption = "SDI-2 Model results",
          rnames = c(table10rows, table10rows, table10rows),
          header = c(table10cols, table10cols, table10cols),
          col.rgroup = c("none", "#F7F7F7"),
          cgroup = list(c("SDI-2"), c("General", "Solitary", "Dyadic")),
          n.cgroup = list(c(3), c(8, 8, 8)),
          tspanner = c("Men","Women not usng hormonal contraception", "Women using hormonal contraception"), n.tspanner = c(7,7),
          css.tspanner = "padding-top: 0.5em; font-weight:bold",
          css.cell = "padding-right: 0.5em")

```

```{r correction for multiple comparisons model setup women, include=FALSE}

womenFalseDiscoveryData <- data.frame('adj alpha' = round(0.05 * ((13 + 1 - c(1:13))/13),3))
womenFalseDiscoveryData["Women's SDI"] <- sort(w.d_w$p[2:14], decreasing=T)
womenFalseDiscoveryData["Women's SDI Sol"] <- sort(w.sol_w$p[2:14], decreasing=T)
womenFalseDiscoveryData["Women's SDI Dyad"] <- sort(w.dyad_w$p[2:14], decreasing=T)
womenFalseDiscoveryData["Women's SOI"] <- sort(w.s_w$p[2:14], decreasing=T)
womenFalseDiscoveryData["Women's SOI Attit"] <- sort(w.att_w$p[2:14], decreasing=T)
womenFalseDiscoveryData["Women's SOI Behav"] <- sort(w.beh_w$p[2:14], decreasing=T)
womenFalseDiscoveryData["Women's SOI Des"] <- sort(w.des_w$p[2:14], decreasing=T)

ncFalseDiscoveryData <- data.frame('adj alpha' = round(0.05 * ((6 + 1 - c(1:6))/6),3))
ncFalseDiscoveryData["NC Women's SDI"] <- sort(nc.d_w$p[2:7], decreasing=T)
ncFalseDiscoveryData["NC Women's SDI Sol"] <- sort(nc.sol_w$p[2:7], decreasing=T)
ncFalseDiscoveryData["NC Women's SDI Dyad"] <- sort(nc.dyad_w$p[2:7], decreasing=T)
ncFalseDiscoveryData["NC Women's SOI"] <- sort(nc.s_w$p[2:7], decreasing=T)
ncFalseDiscoveryData["NC Women's SOI Attit"] <- sort(nc.att_w$p[2:7], decreasing=T)
ncFalseDiscoveryData["NC Women's SOI Behav"] <- sort(nc.beh_w$p[2:7], decreasing=T)
ncFalseDiscoveryData["NC Women's SOI Des"] <- sort(nc.des_w$p[2:7], decreasing=T)

hcFalseDiscoveryData <- data.frame('adj alpha' = round(0.05 * ((6 + 1 - c(1:6))/6),3))
hcFalseDiscoveryData["HC Women's SDI"] <- sort(hc.d_w$p[2:7], decreasing=T)
hcFalseDiscoveryData["HC Women's SDI Sol"] <- sort(hc.sol_w$p[2:7], decreasing=T)
hcFalseDiscoveryData["HC Women's SDI Dyad"] <- sort(hc.dyad_w$p[2:7], decreasing=T)
hcFalseDiscoveryData["HC Women's SOI"] <- sort(hc.s_w$p[2:7], decreasing=T)
hcFalseDiscoveryData["HC Women's SOI Attit"] <- sort(hc.att_w$p[2:7], decreasing=T)
hcFalseDiscoveryData["HC Women's SOI Behav"] <- sort(hc.beh_w$p[2:7], decreasing=T)
hcFalseDiscoveryData["HC Women's SOI Des"] <- sort(hc.des_w$p[2:7], decreasing=T)
```

```{r correction for multiple comparisons model setup men, include=FALSE}
menFalseDiscoveryData <- data.frame('adj alpha' = round(0.05 * ((6 + 1 - c(1:6))/6),3))
menFalseDiscoveryData["Men's SDI"] <- sort(m.d_w$p[2:7], decreasing=T)
menFalseDiscoveryData["Men's SDI Sol"] <- sort(m.sol_w$p[2:7], decreasing=T)
menFalseDiscoveryData["Men's SDI Dyad"] <- sort(m.dyad_w$p[2:7], decreasing=T)
menFalseDiscoveryData["Men's SOI"] <- sort(m.s_w$p[2:7], decreasing=T)
menFalseDiscoveryData["Men's SOI Attit"] <- sort(m.att_w$p[2:7], decreasing=T)
menFalseDiscoveryData["Men's SOI Behav"] <- sort(m.beh_w$p[2:7], decreasing=T)
menFalseDiscoveryData["Men's SOI Des"] <- sort(m.des_w$p[2:7], decreasing=T)
```

```{r correction for multiple comparisons model setup all, include=FALSE}
totalFalseDiscoveryDataWomen <- data.frame('adj alpha' = round(0.05 * ((91 + 1 - c(1:91))/91),3))
totalFalseDiscoveryDataHC <- data.frame('adj alpha' = round(0.05 * ((42 + 1 - c(1:42))/42),3))
totalFalseDiscoveryDataNC <- data.frame('adj alpha' = round(0.05 * ((42 + 1 - c(1:42))/42),3))
totalFalseDiscoveryDataMen <- data.frame('adj alpha' = round(0.05 * ((42 + 1 - c(1:42))/42),3))

totalFalseDiscoveryDataWomen['pVals'] <- sort(c(w.d_w$p[2:14],w.sol_w$p[2:14],w.dyad_w$p[2:14],w.s_w$p[2:14],
                                                w.att_w$p[2:14],w.beh_w$p[2:14],w.des_w$p[2:14]), decreasing=T)

totalFalseDiscoveryDataHC['pVals'] <- sort(c(hc.d_w$p[2:7],hc.sol_w$p[2:7],hc.dyad_w$p[2:7],hc.s_w$p[2:7],
                                             hc.att_w$p[2:7],hc.beh_w$p[2:7],hc.des_w$p[2:7]), decreasing=T)

totalFalseDiscoveryDataNC['pVals'] <- sort(c(nc.d_w$p[2:7],nc.sol_w$p[2:7],nc.dyad_w$p[2:7],nc.s_w$p[2:7],
                                             nc.att_w$p[2:7],nc.beh_w$p[2:7],nc.des_w$p[2:7]), decreasing=T)

totalFalseDiscoveryDataMen['pVals'] <- sort(c(m.d_w$p[2:7],m.sol_w$p[2:7],m.dyad_w$p[2:7],m.s_w$p[2:7],
                                              m.att_w$p[2:7],m.beh_w$p[2:7],m.des_w$p[2:7]), decreasing=T)

```

### False discovery rate data
### adjusted alphas and ordered p-values for each model separately, and for all main analyses together
### women

```{r print false discovery rate data, echo=FALSE}
htmlTable(womenFalseDiscoveryData, caption = "Women's adjusted alphas and p-values")
htmlTable(hcFalseDiscoveryData, caption = "HC women's adjusted alphas and p-values")
htmlTable(ncFalseDiscoveryData, caption = "NC women's adjusted alphas and p-values")
htmlTable(menFalseDiscoveryData, caption = "Men's adjusted alphas and p-values")

htmlTable(totalFalseDiscoveryDataWomen, caption = "Women's (combined) adjusted alphas and p-values")
htmlTable(totalFalseDiscoveryDataHC, caption = "HC women's (combined) adjusted alphas and p-values")
htmlTable(totalFalseDiscoveryDataNC, caption = "NC women's (combined) adjusted alphas and p-values")
htmlTable(totalFalseDiscoveryDataMen, caption = "Men's (combined) adjusted alphas and p-values")
```

## for each parameter, we had 80% power to detect the following effect sizes
### Tables for Men, Women not on HC, women on HC, resptively
```{r, power calculations, echo=FALSE}

m.d_w %>%
  bind_rows(m.sol_w,m.dyad_w, m.s_w, m.att_w, m.beh_w, m.des_w) %>%
  dplyr::select(Effect,SE) %>%
  filter(Effect == "ihh_C.cm:ihh_T.cm" | Effect == "ihh_C.cwc:ihh_T.cwc") %>%
  mutate(Model = c(rep("SDI",2), rep("SDI Solitary",2), rep("SDI Dyadic",2), rep("SOI",2), rep("SOI Attitudes",2), rep("SOI Behavior",2), rep("SOI Desire",2)),
         Parameter = rep(c("within","between"),7),
         "Powered For" = paste("+/-", round(SE * 2.8,3))) %>%
  relocate(Model, .before = Effect) %>%
  relocate(Parameter, .after = Model) %>%
  relocate("Powered For", .after = SE) %>%
  dplyr::select(-c(Effect)) %>%
  htmlTable(align = "l", css.cell = "padding-right: 1.5em")

nc.d_w %>%
  bind_rows(nc.sol_w,nc.dyad_w, nc.s_w, nc.att_w, nc.beh_w, nc.des_w) %>%
  dplyr::select(Effect,SE) %>%
  filter(Effect == "ihh_C.cm:ihh_T.cm" | Effect == "ihh_C.cwc:ihh_T.cwc") %>%
  mutate(Model = c(rep("SDI",2), rep("SDI Solitary",2), rep("SDI Dyadic",2), rep("SOI",2), rep("SOI Attitudes",2), rep("SOI Behavior",2), rep("SOI Desire",2)),
         Parameter = rep(c("within","between"),7),
         "Powered For" = paste("+/-", round(SE * 2.8,3))) %>%
  relocate(Model, .before = Effect) %>%
  relocate(Parameter, .after = Model) %>%
  relocate("Powered For", .after = SE) %>%
  dplyr::select(-c(Effect)) %>%
  htmlTable(align = "l", css.cell = "padding-right: 1.5em")

hc.d_w %>%
  bind_rows(hc.sol_w,hc.dyad_w, hc.s_w, hc.att_w, hc.beh_w, hc.des_w) %>%
  dplyr::select(Effect,SE) %>%
  filter(Effect == "ihh_C.cm:ihh_T.cm" | Effect == "ihh_C.cwc:ihh_T.cwc") %>%
  mutate(Model = c(rep("SDI",2), rep("SDI Solitry",2), rep("SDI Desire",2), rep("SOI",2), rep("SOI Attitudes",2), rep("SOI Behavior",2), rep("SOI Desire",2)),
         Parameter = rep(c("within","between"),7),
         "Powered For" = paste("+/-", round(SE * 2.8,3))) %>%
  relocate(Model, .before = Effect) %>%
  relocate(Parameter, .after = Model) %>%
  relocate("Powered For", .after = SE) %>%
  dplyr::select(-c(Effect)) %>%
  htmlTable(align = "l", css.cell = "padding-right: 1.5em")
```

### 12. Other robustness

#### subsection 1 - ovarian hormones as covariates
#### Women not on hormonal contraception
##### within-section model order: SDI general, SDI solitary, SDI dyadic, SOI general, SOI attitudes, SOI behavior, SOI desire
```{r, robustness models ovarion nc, echo=FALSE}

# do effects of C and T remain after accounting for effects of ovarian hormones on SDI and/or SOI in non-contracepting women?

table.model(summary(lmer(sdi_mean ~ ihh_P.cwc*ihh_E.cwc + ihh_P.cm*ihh_E.cm + ihh_C.cwc*ihh_T.cwc +
                 ihh_C.cm*ihh_T.cm + (1 | subID), data = df.nc))) # sdi-2

table.model(summary(lmer(sdi_sol ~ ihh_P.cwc*ihh_E.cwc + ihh_P.cm*ihh_E.cm + ihh_C.cwc*ihh_T.cwc +
                   ihh_C.cm*ihh_T.cm + (1 | subID), data = df.nc))) # sdi-2[solitary]

table.model(summary(lmer(sdi_dyad ~ ihh_P.cwc*ihh_E.cwc + ihh_P.cm*ihh_E.cm + ihh_C.cwc*ihh_T.cwc +
                    ihh_C.cm*ihh_T.cm + (1 | subID), data = df.nc))) # sdi-2[dyadic]

table.model(summary(lmer(soi_mean ~ ihh_P.cwc*ihh_E.cwc + ihh_P.cm*ihh_E.cm + ihh_C.cwc*ihh_T.cwc +
                 ihh_C.cm*ihh_T.cm + (1 | subID), data = df.nc))) # soiR

table.model(summary(lmer(soi_attit ~ ihh_P.cwc*ihh_E.cwc + ihh_P.cm*ihh_E.cm + ihh_C.cwc*ihh_T.cwc +
                   ihh_C.cm*ihh_T.cm + (1 | subID), data = df.nc))) # soi-R[attitude]

table.model(summary(lmer(soi_behav ~ ihh_P.cwc*ihh_E.cwc + ihh_P.cm*ihh_E.cm + ihh_C.cwc*ihh_T.cwc +
                   ihh_C.cm*ihh_T.cm + (1 | subID), data = df.nc))) # soi-R[behavior]

table.model(summary(lmer(soi_des ~ ihh_P.cwc*ihh_E.cwc + ihh_P.cm*ihh_E.cm + ihh_C.cwc*ihh_T.cwc +
                   ihh_C.cm*ihh_T.cm + (1 | subID), data = df.nc))) # soi-R[desire]

```

#### Women on hormonal contraception
##### within-section model order: SDI general, SDI solitary, SDI dyadic, SOI general, SOI attitudes, SOI behavior, SOI desire
```{r, robustness models ovarian hc, echo=FALSE}

table.model(summary(lmer(sdi_mean ~ ihh_P.cwc*ihh_E.cwc + ihh_P.cm*ihh_E.cm + ihh_C.cwc*ihh_T.cwc +
                 ihh_C.cm*ihh_T.cm + (1 | subID), data = df.hc))) # sdi-2

table.model(summary(lmer(sdi_sol ~ ihh_P.cwc*ihh_E.cwc + ihh_P.cm*ihh_E.cm + ihh_C.cwc*ihh_T.cwc +
                   ihh_C.cm*ihh_T.cm + (1 | subID), data = df.hc))) # sdi-2[solitary]

table.model(summary(lmer(sdi_dyad ~ ihh_P.cwc*ihh_E.cwc + ihh_P.cm*ihh_E.cm + ihh_C.cwc*ihh_T.cwc +
                    ihh_C.cm*ihh_T.cm + (1 | subID), data = df.hc))) # sdi-2[dyadic]

table.model(summary(lmer(soi_mean ~ ihh_P.cwc*ihh_E.cwc + ihh_P.cm*ihh_E.cm + ihh_C.cwc*ihh_T.cwc +
                 ihh_C.cm*ihh_T.cm + (1 | subID), data = df.hc))) # soiR

table.model(summary(lmer(soi_attit ~ ihh_P.cwc*ihh_E.cwc + ihh_P.cm*ihh_E.cm + ihh_C.cwc*ihh_T.cwc +
                   ihh_C.cm*ihh_T.cm + (1 | subID), data = df.hc))) # soi-R[attitude]

table.model(summary(lmer(soi_behav ~ ihh_P.cwc*ihh_E.cwc + ihh_P.cm*ihh_E.cm + ihh_C.cwc*ihh_T.cwc +
                   ihh_C.cm*ihh_T.cm + (1 | subID), data = df.hc))) # soi-R[behavior]

table.model(summary(lmer(soi_des ~ ihh_P.cwc*ihh_E.cwc + ihh_P.cm*ihh_E.cm + ihh_C.cwc*ihh_T.cwc +
                   ihh_C.cm*ihh_T.cm + (1 | subID), data = df.hc))) # soi-R[desire]

```

#### subsection 2 - men - predictor hormones log-transformed
##### within-section model order: SDI general, SDI solitary, SDI dyadic, SOI general, SOI attitudes, SOI behavior, SOI desire
```{r, robustness models 2, echo=FALSE}
# With predictor hormones log-transformed before centering and scaling

# men

table.model(summary(lmer(sdi_mean ~ ihh_T.log.cwc*ihh_C.log.cwc +
                                      ihh_T.log.cm*ihh_C.log.cm + (1 | subID), data = df.log.m))) # sdi-2

table.model(summary(lmer(sdi_sol ~ ihh_T.log.cwc*ihh_C.log.cwc +
                                        ihh_T.log.cm*ihh_C.log.cm + (1 | subID), data = df.log.m))) # sdi-2[solitary]

table.model(summary(lmer(sdi_dyad ~ ihh_T.log.cwc*ihh_C.log.cwc +
                                         ihh_T.log.cm*ihh_C.log.cm + (1 | subID), data = df.log.m))) # sdi-2[dyadic]

table.model(summary(lmer(soi_mean ~ ihh_T.log.cwc*ihh_C.log.cwc +
                                      ihh_T.log.cm*ihh_C.log.cm + (1 | subID), data = df.log.m))) # soiR

table.model(summary(lmer(soi_attit ~ ihh_T.log.cwc*ihh_C.log.cwc +
                                        ihh_T.log.cm*ihh_C.log.cm + (1 | subID), data = df.log.m))) # soi-R[attitude]

table.model(summary(lmer(soi_behav ~ ihh_T.log.cwc*ihh_C.log.cwc +
                                        ihh_T.log.cm*ihh_C.log.cm + (1 | subID), data = df.log.m))) # soi-R[behavior]

table.model(summary(lmer(soi_des ~ ihh_T.log.cwc*ihh_C.log.cwc +
                                        ihh_T.log.cm*ihh_C.log.cm + (1 | subID), data = df.log.m))) # soi-R[desire]

```

#### subsection 3 - women - predictor hormones log-transformed
##### within-section model order: SDI general, SDI solitary, SDI dyadic, SOI general, SOI attitudes, SOI behavior, SOI desire
```{r, robustness models 3, echo=FALSE}
# women

table.model(summary(lmer(sdi_mean ~ ihh_T.log.cwc*ihh_C.log.cwc*HC +
                                      ihh_T.log.cm*ihh_C.log.cm*HC + (1 | subID), data = df.log.f))) # sdi-2

table.model(summary(lmer(sdi_sol ~ ihh_T.log.cwc*ihh_C.log.cwc*HC +
                                        ihh_T.log.cm*ihh_C.log.cm*HC + (1 | subID), data = df.log.f))) # sdi solitary

table.model(summary(lmer(sdi_dyad ~ ihh_T.log.cwc*ihh_C.log.cwc*HC + 
                                         ihh_T.log.cm*ihh_C.log.cm*HC + (1 | subID), data = df.log.f))) # sdi dyadic

table.model(summary(lmer(soi_mean ~ ihh_T.log.cwc*ihh_C.log.cwc*HC +
                                      ihh_T.log.cm*ihh_C.log.cm*HC + (1 | subID), data = df.log.f))) # soiR

table.model(summary(lmer(soi_attit ~ ihh_T.log.cwc*ihh_C.log.cwc*HC +
                                        ihh_T.log.cm*ihh_C.log.cm*HC + (1 | subID), data = df.log.f))) # attitude

table.model(summary(lmer(soi_behav ~ ihh_T.log.cwc*ihh_C.log.cwc*HC +
                                        ihh_T.log.cm*ihh_C.log.cm*HC + (1 | subID), data = df.log.f))) # behavior

table.model(summary(lmer(soi_des ~ ihh_T.log.cwc*ihh_C.log.cwc*HC +
                                        ihh_T.log.cm*ihh_C.log.cm*HC + (1 | subID), data = df.log.f))) # soi desire

```

#### subsection 4 - men - with age as covariate
##### within-section model order: SDI general, SDI solitary, SDI dyadic, SOI general, SOI attitudes, SOI behavior, SOI desire
```{r, robustness models 4, echo=FALSE}

# age

# men

table.model(summary(lmer(sdi_mean ~ ihh_T.cwc*ihh_C.cwc + ihh_T.cm*ihh_C.cm + age + (1 | subID), data = df.m))) # sdi-2

table.model(summary(lmer(sdi_sol ~ ihh_T.cwc*ihh_C.cwc + ihh_T.cm*ihh_C.cm + age + (1 | subID), data = df.m))) # sdi-2[solitary]

table.model(summary(lmer(sdi_dyad ~ ihh_T.cwc*ihh_C.cwc + ihh_T.cm*ihh_C.cm + age + (1 | subID), data = df.m))) # sdi-2[dyadic]

table.model(summary(lmer(soi_mean ~ ihh_T.cwc*ihh_C.cwc + ihh_T.cm*ihh_C.cm + age + (1 | subID), data = df.m))) # soiR

table.model(summary(lmer(soi_attit ~ ihh_T.cwc*ihh_C.cwc + ihh_T.cm*ihh_C.cm + age + (1 | subID), data = df.m))) # soi-R[attitude]

table.model(summary(lmer(soi_behav ~ ihh_T.cwc*ihh_C.cwc + ihh_T.cm*ihh_C.cm + age + (1 | subID), data = df.m))) # soi-R[behavior]

table.model(summary(lmer(soi_des ~ ihh_T.cwc*ihh_C.cwc + ihh_T.cm*ihh_C.cm + age + (1 | subID), data = df.m))) # soi-R[desire]

```

#### subsection 5 - women - with age as covariate
##### within-section model order: SDI general, SDI solitary, SDI dyadic, SOI general, SOI attitudes, SOI behavior, SOI desire
```{r, robustness models 5, echo=FALSE}

# women

table.model(summary(lmer(sdi_mean ~ ihh_T.cwc*ihh_C.cwc*HC + ihh_T.cm*ihh_C.cm*HC + age + (1 | subID), data = df.f))) # sdi-2

table.model(summary(lmer(sdi_sol ~ ihh_T.cwc*ihh_C.cwc*HC + ihh_T.cm*ihh_C.cm*HC + age + (1 | subID), data = df.f))) # sdi-2[solitary]

table.model(summary(lmer(sdi_dyad ~ ihh_T.cwc*ihh_C.cwc*HC + ihh_T.cm*ihh_C.cm*HC + age + (1 | subID), data = df.f))) # sdi-2[dyadic]

table.model(summary(lmer(soi_mean ~ ihh_T.cwc*ihh_C.cwc*HC + ihh_T.cm*ihh_C.cm*HC + age + (1 | subID), data = df.f))) # soiR

table.model(summary(lmer(soi_attit ~ ihh_T.cwc*ihh_C.cwc*HC + ihh_T.cm*ihh_C.cm*HC + age + (1 | subID), data = df.f))) # soi-R[attitude]

table.model(summary(lmer(soi_behav ~ ihh_T.cwc*ihh_C.cwc*HC + ihh_T.cm*ihh_C.cm*HC + age + (1 | subID), data = df.f))) # soi-R[behavior]

table.model(summary(lmer(soi_des ~ ihh_T.cwc*ihh_C.cwc*HC + ihh_T.cm*ihh_C.cm*HC + age + (1 | subID), data = df.f))) # soi-R[desire]

```

#### subsection 6 - men - with time of day as covariate
##### within-section model order: SDI general, SDI solitary, SDI dyadic, SOI general, SOI attitudes, SOI behavior, SOI desire
```{r, robustness models 6, echo=FALSE}
# time

# men

table.model(summary(lmer(sdi_mean ~ ihh_T.cwc*ihh_C.cwc + ihh_T.cm*ihh_C.cm + time + (1 | subID), data = df.m))) # sdi-2

table.model(summary(lmer(sdi_sol ~ ihh_T.cwc*ihh_C.cwc + ihh_T.cm*ihh_C.cm + time + (1 | subID), data = df.m))) # sdi-2[solitary]

table.model(summary(lmer(sdi_dyad ~ ihh_T.cwc*ihh_C.cwc + ihh_T.cm*ihh_C.cm + time + (1 | subID), data = df.m))) # sdi-2[dyadic]

table.model(summary(lmer(soi_mean ~ ihh_T.cwc*ihh_C.cwc + ihh_T.cm*ihh_C.cm + time + (1 | subID), data = df.m))) # soiR

table.model(summary(lmer(soi_attit ~ ihh_T.cwc*ihh_C.cwc + ihh_T.cm*ihh_C.cm + time + (1 | subID), data = df.m))) # soi-R[attitude]

table.model(summary(lmer(soi_behav ~ ihh_T.cwc*ihh_C.cwc + ihh_T.cm*ihh_C.cm + time + (1 | subID), data = df.m))) # soi-R[behavior]

table.model(summary(lmer(soi_des ~ ihh_T.cwc*ihh_C.cwc + ihh_T.cm*ihh_C.cm + time + (1 | subID), data = df.m))) # soi-R[desire]

```

#### subsection 7 - women - with time of day as covariate
##### within-section model order: SDI general, SDI solitary, SDI dyadic, SOI general, SOI attitudes, SOI behavior, SOI desire
```{r, robustness models 7, echo=FALSE}

# women

table.model(summary(lmer(sdi_mean ~ ihh_T.cwc*ihh_C.cwc*HC + ihh_T.cm*ihh_C.cm*HC + time + (1 | subID), data = df.f))) # sdi-2

table.model(summary(lmer(sdi_sol ~ ihh_T.cwc*ihh_C.cwc*HC + ihh_T.cm*ihh_C.cm*HC + time + (1 | subID), data = df.f))) # sdi-2[solitary]

table.model(summary(lmer(sdi_dyad ~ ihh_T.cwc*ihh_C.cwc*HC + ihh_T.cm*ihh_C.cm*HC + time + (1 | subID), data = df.f))) # sdi-2[dyadic]

table.model(summary(lmer(soi_mean ~ ihh_T.cwc*ihh_C.cwc*HC + ihh_T.cm*ihh_C.cm*HC + time + (1 | subID), data = df.f))) # soiR

table.model(summary(lmer(soi_attit ~ ihh_T.cwc*ihh_C.cwc*HC + ihh_T.cm*ihh_C.cm*HC + time + (1 | subID), data = df.f))) # soi-R[attitude]

table.model(summary(lmer(soi_behav ~ ihh_T.cwc*ihh_C.cwc*HC + ihh_T.cm*ihh_C.cm*HC + time + (1 | subID), data = df.f))) # soi-R[behavior]

table.model(summary(lmer(soi_des ~ ihh_T.cwc*ihh_C.cwc*HC + ihh_T.cm*ihh_C.cm*HC + time + (1 | subID), data = df.f))) # soi-R[desire]

```

### subsection 8 - men - main analyses repeated with random slopes
##### within-section model order: SDI general, SDI solitary, SDI dyadic, SOI general, SOI attitudes, SOI behavior, SOI desire

```{r, robustness models 8, echo=FALSE}
m.d_w <- table.model(summary(lmer(sdi_mean ~ ihh_T.cwc*ihh_C.cwc + ihh_T.cm*ihh_C.cm + (1 + ihh_T.cwc*ihh_C.cwc || subID),
                                  data = df.m))) # sdi-2

table.model(summary(lmer(sdi_sol ~ ihh_T.cwc*ihh_C.cwc + ihh_T.cm*ihh_C.cm + (1 + ihh_T.cwc*ihh_C.cwc || subID),
                                    data = df.m))) # sdi-2[solitary]

table.model(summary(lmer(sdi_dyad ~ ihh_T.cwc*ihh_C.cwc + ihh_T.cm*ihh_C.cm + (1 + ihh_T.cwc*ihh_C.cwc || subID),
                                     data = df.m))) # sdi-2[dyadic]

table.model(summary(lmer(soi_mean ~ ihh_T.cwc*ihh_C.cwc + ihh_T.cm*ihh_C.cm + (1 + ihh_T.cwc*ihh_C.cwc || subID),
                                  data = df.m))) # soiR

table.model(summary(lmer(soi_attit ~ ihh_T.cwc*ihh_C.cwc + ihh_T.cm*ihh_C.cm + (1 + ihh_T.cwc*ihh_C.cwc || subID),
                                    data = df.m))) # soi-R[attitude]

table.model(summary(lmer(soi_behav ~ ihh_T.cwc*ihh_C.cwc + ihh_T.cm*ihh_C.cm + (1 + ihh_T.cwc*ihh_C.cwc || subID),
                                    data = df.m))) # soi-R[behavior]

table.model(summary(lmer(soi_des ~ ihh_T.cwc*ihh_C.cwc + ihh_T.cm*ihh_C.cm + (1 + ihh_T.cwc*ihh_C.cwc || subID),
                                    data = df.m))) # soi-R[desire]
```

# subsection 9 - women -  main analyses repeated with random slopes
##### within-section model order: SDI general, SDI solitary, SDI dyadic, SOI general, SOI attitudes, SOI behavior, SOI desire

```{r, robustness models 9, echo=FALSE}
table.model(summary(lmer(sdi_mean ~ ihh_T.cwc*ihh_C.cwc*HC + ihh_T.cm*ihh_C.cm*HC + (1 + ihh_T.cwc*ihh_C.cwc || subID),
                                  data = df.f))) # sdi-2

table.model(summary(lmer(sdi_sol ~ ihh_T.cwc*ihh_C.cwc*HC + ihh_T.cm*ihh_C.cm*HC + (1 + ihh_T.cwc*ihh_C.cwc || subID),
                                    data = df.f))) # sdi-2[solitary]

table.model(summary(lmer(sdi_dyad ~ ihh_T.cwc*ihh_C.cwc*HC + ihh_T.cm*ihh_C.cm*HC + (1 + ihh_T.cwc*ihh_C.cwc || subID),
                                     data = df.f))) # sdi-2[dyadic]

table.model(summary(lmer(soi_mean ~ ihh_T.cwc*ihh_C.cwc*HC + ihh_T.cm*ihh_C.cm*HC + (1 + ihh_T.cwc*ihh_C.cwc || subID),
                                  data = df.f))) # soiR

table.model(summary(lmer(soi_attit ~ ihh_T.cwc*ihh_C.cwc*HC + ihh_T.cm*ihh_C.cm*HC + (1 + ihh_T.cwc*ihh_C.cwc || subID),
                                    data = df.f))) # soi-R[attitude]

table.model(summary(lmer(soi_behav ~ ihh_T.cwc*ihh_C.cwc*HC + ihh_T.cm*ihh_C.cm*HC + (1 + ihh_T.cwc*ihh_C.cwc || subID),
                                    data = df.f))) # soi-R[behavior]

table.model(summary(lmer(soi_des ~ ihh_T.cwc*ihh_C.cwc*HC + ihh_T.cm*ihh_C.cm*HC + (1 + ihh_T.cwc*ihh_C.cwc || subID),
                                    data = df.f))) # soi-R[desire]


```

# subsection 10 - men -  main analyses repeated excluding 14 subjects over age 45 (3 men)
##### within-section model order: SDI general, SDI solitary, SDI dyadic, SOI general, SOI attitudes, SOI behavior, SOI desire

```{r, robustness models 10, echo=FALSE}

table.model(summary(lmer(sdi_mean ~ ihh_T.cwc*ihh_C.cwc + ihh_T.cm*ihh_C.cm + (1 | subID), data = df.m %>% filter(age<46)))) # sdi-2

table.model(summary(lmer(sdi_sol ~ ihh_T.cwc*ihh_C.cwc + ihh_T.cm*ihh_C.cm + (1 | subID),
                                            data = df.m %>% filter(age<46)))) # sdi-2[solitary]

table.model(summary(lmer(sdi_dyad ~ ihh_T.cwc*ihh_C.cwc + ihh_T.cm*ihh_C.cm + (1 | subID),
                                             data = df.m %>% filter(age<46)))) # sdi-2[dyadic]

table.model(summary(lmer(soi_mean ~ ihh_T.cwc*ihh_C.cwc + ihh_T.cm*ihh_C.cm + (1 | subID), data = df.m %>% filter(age<46)))) # soiR

table.model(summary(lmer(soi_attit ~ ihh_T.cwc*ihh_C.cwc + ihh_T.cm*ihh_C.cm + (1 | subID),
                                            data = df.m %>% filter(age<46)))) # soi-R[attitude]

table.model(summary(lmer(soi_behav ~ ihh_T.cwc*ihh_C.cwc + ihh_T.cm*ihh_C.cm + (1 | subID),
                                            data = df.m %>% filter(age<46)))) # soi-R[behavior]

table.model(summary(lmer(soi_des ~ ihh_T.cwc*ihh_C.cwc + ihh_T.cm*ihh_C.cm + (1 | subID),
                                            data = df.m %>% filter(age<46)))) # soi-R[desire]
```

# subsection 11 - women -  main analyses repeated excluding 14 subjects over age 45 (11 women)
##### within-section model order: SDI general, SDI solitary, SDI dyadic, SOI general, SOI attitudes, SOI behavior, SOI desire

```{r, robustness models 11, echo=FALSE}

table.model(summary(lmer(sdi_mean ~ ihh_T.cwc*ihh_C.cwc*HC + ihh_T.cm*ihh_C.cm*HC + (1 | subID),
                                          data = df.f %>% filter(age<46)))) # sdi-2

table.model(summary(lmer(sdi_sol ~ ihh_T.cwc*ihh_C.cwc*HC + ihh_T.cm*ihh_C.cm*HC + (1 | subID),
                                            data = df.f %>% filter(age<46)))) # sdi-2[solitary]

table.model(summary(lmer(sdi_dyad ~ ihh_T.cwc*ihh_C.cwc*HC + ihh_T.cm*ihh_C.cm*HC + (1 | subID),
                                             data = df.f %>% filter(age<46)))) # sdi-2[dyadic]

table.model(summary(lmer(soi_mean ~ ihh_T.cwc*ihh_C.cwc*HC + ihh_T.cm*ihh_C.cm*HC + (1 | subID),
                                          data = df.f %>% filter(age<46)))) # soiR

table.model(summary(lmer(soi_attit ~ ihh_T.cwc*ihh_C.cwc*HC + ihh_T.cm*ihh_C.cm*HC + (1 | subID),
                                            data = df.f %>% filter(age<46)))) # soi-R[attitude]

table.model(summary(lmer(soi_behav ~ ihh_T.cwc*ihh_C.cwc*HC + ihh_T.cm*ihh_C.cm*HC + (1 | subID),
                                            data = df.f %>% filter(age<46)))) # soi-R[behavior]

table.model(summary(lmer(soi_des ~ ihh_T.cwc*ihh_C.cwc*HC + ihh_T.cm*ihh_C.cm*HC + (1 | subID),
                                            data = df.f %>% filter(age<46)))) # soi-R[desire]
```

# subsection 12 - women -  main analyses repeated excluding one woman who attended a single session and whose cortisol measured over 50 pg/mL
##### within-section model order: SDI general, SDI solitary, SDI dyadic, SOI general, SOI attitudes, SOI behavior, SOI desire

```{r, robustness models 12, echo=FALSE}

# women

table.model(summary(lmer(sdi_mean ~ ihh_T.cwc*ihh_C.cwc*HC + ihh_T.cm*ihh_C.cm*HC + (1 | subID),
                                          data = df.f %>% filter(ihh_C<50)))) # sdi-2

table.model(summary(lmer(sdi_sol ~ ihh_T.cwc*ihh_C.cwc*HC + ihh_T.cm*ihh_C.cm*HC + (1 | subID),
                                            data = df.f %>% filter(ihh_C<50)))) # sdi-2[solitary]

table.model(summary(lmer(sdi_dyad ~ ihh_T.cwc*ihh_C.cwc*HC + ihh_T.cm*ihh_C.cm*HC + (1 | subID),
                                             data = df.f %>% filter(ihh_C<50)))) # sdi-2[dyadic]

table.model(summary(lmer(soi_mean ~ ihh_T.cwc*ihh_C.cwc*HC + ihh_T.cm*ihh_C.cm*HC + (1 | subID),
                                          data = df.f %>% filter(ihh_C<50)))) # soiR

table.model(summary(lmer(soi_attit ~ ihh_T.cwc*ihh_C.cwc*HC + ihh_T.cm*ihh_C.cm*HC + (1 | subID),
                                            data = df.f %>% filter(ihh_C<50)))) # soi-R[attitude]

table.model(summary(lmer(soi_behav ~ ihh_T.cwc*ihh_C.cwc*HC + ihh_T.cm*ihh_C.cm*HC + (1 | subID),
                                            data = df.f %>% filter(ihh_C<50)))) # soi-R[behavior]

table.model(summary(lmer(soi_des ~ ihh_T.cwc*ihh_C.cwc*HC + ihh_T.cm*ihh_C.cm*HC + (1 | subID),
                                            data = df.f %>% filter(ihh_C<50)))) # soi-R[desire]
```

# Main analyses excluding five NC and ten HC women whose testosterone measured over 50 pg/mL
#### all women - ##### within-section model order: SDI general, SDI solitary, SDI dyadic, SOI general, SOI attitudes, SOI behavior, SOI desire

```{r, robustness models 12.1, echo=FALSE}
table.model(summary(lmer(sdi_mean ~ ihh_T.cwc*ihh_C.cwc*HC + ihh_T.cm*ihh_C.cm*HC + (1 | subID),
                                        data = df.f %>% filter(ihh_T<50)))) # sdi-2

table.model(summary(lmer(sdi_sol ~ ihh_T.cwc*ihh_C.cwc*HC + ihh_T.cm*ihh_C.cm*HC + (1 | subID),
                                          data = df.f %>% filter(ihh_T<50)))) # sdi-2[solitary]

table.model(summary(lmer(sdi_dyad ~ ihh_T.cwc*ihh_C.cwc*HC + ihh_T.cm*ihh_C.cm*HC + (1 | subID),
                                           data = df.f %>% filter(ihh_T<50)))) # sdi-2[dyadic]

table.model(summary(lmer(soi_mean ~ ihh_T.cwc*ihh_C.cwc*HC + ihh_T.cm*ihh_C.cm*HC + (1 | subID),
                                        data = df.f %>% filter(ihh_T<50)))) # soiR

table.model(summary(lmer(soi_attit ~ ihh_T.cwc*ihh_C.cwc*HC + ihh_T.cm*ihh_C.cm*HC + (1 | subID),
                                          data = df.f %>% filter(ihh_T<50)))) # soi-R[attitude]

table.model(summary(lmer(soi_behav ~ ihh_T.cwc*ihh_C.cwc*HC + ihh_T.cm*ihh_C.cm*HC + (1 | subID),
                                          data = df.f %>% filter(ihh_T<50)))) # soi-R[behavior]

table.model(summary(lmer(soi_des ~ ihh_T.cwc*ihh_C.cwc*HC + ihh_T.cm*ihh_C.cm*HC + (1 | subID),
                                          data = df.f %>% filter(ihh_T<50)))) # soi-R[desire]
```


# NC women

```{r, robustness models 12.2, echo=FALSE}
table.model(summary(lmer(sdi_mean ~ ihh_T.cwc*ihh_C.cwc + ihh_T.cm*ihh_C.cm + (1 | subID),
                                        data = df.nc %>% filter(ihh_T<50)))) # sdi-2

table.model(summary(lmer(sdi_sol ~ ihh_T.cwc*ihh_C.cwc + ihh_T.cm*ihh_C.cm + (1 | subID),
                                          data = df.nc %>% filter(ihh_T<50)))) # sdi-2[solitary]

table.model(summary(lmer(sdi_dyad ~ ihh_T.cwc*ihh_C.cwc + ihh_T.cm*ihh_C.cm + (1 | subID),
                                           data = df.nc %>% filter(ihh_T<50)))) # sdi-2[dyadic]

table.model(summary(lmer(soi_mean ~ ihh_T.cwc*ihh_C.cwc + ihh_T.cm*ihh_C.cm + (1 | subID),
                                        data = df.nc %>% filter(ihh_T<50)))) # soiR

table.model(summary(lmer(soi_attit ~ ihh_T.cwc*ihh_C.cwc + ihh_T.cm*ihh_C.cm + (1 | subID),
                                          data = df.nc %>% filter(ihh_T<50)))) # soi-R[attitude]

table.model(summary(lmer(soi_behav ~ ihh_T.cwc*ihh_C.cwc + ihh_T.cm*ihh_C.cm + (1 | subID),
                                          data = df.nc %>% filter(ihh_T<50)))) # soi-R[behavior]

table.model(summary(lmer(soi_des ~ ihh_T.cwc*ihh_C.cwc + ihh_T.cm*ihh_C.cm + (1 | subID),
                                          data = df.nc %>% filter(ihh_T<50)))) # soi-R[desire]
```

# HC women
```{r, robustness models 12.3, echo=FALSE}
table.model(summary(lmer(sdi_mean ~ ihh_T.cwc*ihh_C.cwc + ihh_T.cm*ihh_C.cm + (1 | subID),
                                         data = df.hc %>% filter(ihh_T<50)))) # sdi-2

table.model(summary(lmer(sdi_sol ~ ihh_T.cwc*ihh_C.cwc + ihh_T.cm*ihh_C.cm + (1 | subID),
                                           data = df.hc %>% filter(ihh_T<50)))) # sdi-2[solitary]

table.model(summary(lmer(sdi_dyad ~ ihh_T.cwc*ihh_C.cwc + ihh_T.cm*ihh_C.cm + (1 | subID),
                                            data = df.hc %>% filter(ihh_T<50)))) # sdi-2[dyadic]

table.model(summary(lmer(soi_mean ~ ihh_T.cwc*ihh_C.cwc + ihh_T.cm*ihh_C.cm + (1 | subID),
                                         data = df.hc %>% filter(ihh_T<50)))) # soiR

table.model(summary(lmer(soi_attit ~ ihh_T.cwc*ihh_C.cwc + ihh_T.cm*ihh_C.cm + (1 | subID),
                                           data = df.hc %>% filter(ihh_T<50)))) # soi-R[attitude]

table.model(summary(lmer(soi_behav ~ ihh_T.cwc*ihh_C.cwc + ihh_T.cm*ihh_C.cm + (1 | subID),
                                           data = df.hc %>% filter(ihh_T<50)))) # soi-R[behavior]

table.model(summary(lmer(soi_des ~ ihh_T.cwc*ihh_C.cwc + ihh_T.cm*ihh_C.cm + (1 | subID),
                                           data = df.hc %>% filter(ihh_T<50)))) # soi-R[desire]
```

### 13. Testing Puts et al. negative feedback loop model

#### Women
```{r Puts e al. women, echo=FALSE}
# Testing Puts et al. negative feedback loop model

table.model(summary(lmer(ihh_T.cwc ~ soi_psych + soi_behav + (1 | subID), data = df.f)))

```

#### Men
```{r Puts e al. men, echo=FALSE}

table.model(summary(lmer(ihh_T.cwc ~ soi_psych + soi_behav + (1 | subID), data = df.m)))

```

### 14. Package citations

```{r citations, echo=FALSE}

lapply(c("tidyverse", "dplyr", "lmerTest", "psych", "sjPlot", "sjmisc", "sjlabelled",
         "data.table", "reshape2", "ggcorrplot", "stargazer", "gridExtra", "htmlTable"), FUN = citation)

```
